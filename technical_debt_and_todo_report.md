# 技術的負債と未完了タスクに関するレポート

## 1. はじめに

本レポートは、プロジェクト内のドキュメントを横断的に分析し、現在認識されている技術的負債と、見逃されている、あるいは未着手のタスクを洗い出したものです。これらの課題を解決することは、プロジェクトの健全性、開発速度、および将来の拡張性を向上させるために不可欠です。

## 2. 主要な技術的負債

現在、プロジェクトは以下の4つの主要な技術的負債を抱えています。

### 負債1: アーキテクチャの不統一

-   **内容**: モバイルアプリ (`focus-flow-capacitor`) はVue.js + Capacitorで、デスクトップアプリ (`focus-flow-app`) は素のJavaScript + Electronで構築されており、コードベースが完全に分離しています。
-   **問題点**:
    -   UIコンポーネントやビジネスロジックが重複して実装されており、開発コストが2倍になっています。
    -   プラットフォームごとに異なるバグが発生し、メンテナンスが複雑化しています。
    -   一貫したユーザー体験の提供が困難です。
-   **根本原因**: 開発初期段階で、デスクトップアプリの迅速な開発のためにElectronが採用されましたが、その後のアーキテクチャ統一が見送られています (`docs/adr/001-desktop-framework-selection.md`)。
-   **関連ドキュメント**: `docs/adr/0001-capacitor-unified-architecture.md`, `.claude/context/debt.md`

### 負債2: 状態管理の不整合

-   **内容**: CapacitorアプリではPiniaの導入が中途半端な状態であり、Electronアプリではグローバル変数やDOMへの直接保存など、場当たり的な状態管理が行われています。
-   **問題点**:
    -   状態の変更が追跡しづらく、デバッグが困難です。
    -   アプリケーションの複雑化に伴い、予期せぬ副作用やバグが発生するリスクが非常に高いです。
    -   ロジックの再利用ができず、コードの肥大化を招きます。
-   **関連ドキュメント**: `.claude/context/debt.md`

### 負債3: テストカバレッジの低さ

-   **内容**: TDD（テスト駆動開発）がルールとして掲げられているにも関わらず、UIコンポーネントやビジネスロジックに対する単体・結合テストが著しく不足しています。Electronアプリに至っては、テストフレームワーク自体が導入されていません。
-   **問題点**:
    -   リファクタリングや機能追加が安全に行えず、デグレードのリスクが高いです。
    -   手動でのテストに依存するため、開発サイクルが遅延します。
    -   品質保証の仕組みが形骸化しています。
-   **関連ドキュメント**: `.claude/context/debt.md`, `docs/development/requirements-status.md` (NF-003)

### 負債4: ドキュメントの陳腐化

-   **内容**: `docs/design` 以下のワイヤーフレームや、`MIGRATION_GUIDE.md` など、一部のドキュメントが現在の実装と乖離しています。
-   **問題点**:
    -   新規参画者の学習コストを増大させます。
    -   誤った情報に基づいて開発を進めてしまうリスクがあります。
    -   プロジェクトの全体像を正確に把握することが困難です。
-   **関連ドキュメント**: `.claude/context/debt.md`

## 3. 未完了・見逃されているタスク一覧

上記の技術的負債と密接に関連し、対応が遅れているタスクは以下の通りです。

### 優先度: 高

| ID | タスク概要 | 状況 | 関連する負債 | 出典 |
|---|---|---|---|---|
| `ISSUE-001` | **モバイル版で長いタスク名がUIを破壊する** | `Open` | - | `issues-tracking.md` |
| `Debt #3` | **テストフレームワークの導入と拡充** | `未着手` | 負債3 | `debt.md` |
| `Debt #2` | **統一的な状態管理ライブラリの導入** | `未着手` | 負債2 | `debt.md` |
| `NF-004` | **データ永続化方法の改善** (`localStorage` → `IndexedDB`/`SQLite`) | `部分的` | 負債2 | `requirements-status.md` |

### 優先度: 中

| ID | タスク概要 | 状況 | 関連する負債 | 出典 |
|---|---|---|---|---|
| `ISSUE-003` | **ElectronからTauriへの移行検討** | `In Progress` | 負債1 | `issues-tracking.md` |
| `ADR-0001` | **Capacitorによるアーキテクチャ統一のPoC** | `未着手` | 負債1 | `adr/0001-...` |
| `EXT-002` | **カレンダービュー機能** | `未着手` | - | `phase-todo.md` |
| `EXT-004` | **フォーカス統計機能** | `未着手` | - | `phase-todo.md` |
| `ISSUE-002` | **テーマ切り替え機能（ライト/ダーク）** | `Open` | - | `issues-tracking.md` |
| `ISSUE-005` | **Windowsでの通知の文字化け修正** | `Open` | - | `issues-tracking.md` |
| `Debt #4` | **ドキュメントの棚卸しと更新プロセスの確立** | `未着手` | 負債4 | `debt.md` |

### 優先度: 低

| ID | タスク概要 | 状況 | 関連する負債 | 出典 |
|---|---|---|---|---|
| `ISSUE-004` | **依存関係の更新** | `Open` | - | `issues-tracking.md` |
| `2b` | **ポモドーロタイマーのカスタマイズ機能** | `未着手` | - | `phase-todo.md` |
| `3a-c` | **将来フェーズのタスク群** (デスクトップ正式版, プラグイン, AI機能強化) | `未着手` | 負債1 | `phase-todo.md` |

## 4. コードとドキュメントの矛盾・実装不備

`focus-flow-capacitor` のプロダクトコードと進捗管理ドキュメントを突き合わせた結果、以下の矛盾と実装不備が確認されました。

### 4.1. 「完了」タスクの不完全な実装

進捗管理上は「完了」とされている機能が、コードレベルでは未実装または不完全な状態です。

-   **日付ピッカー機能の欠落**:
    -   **状況**: `phase-todo.md`では「Phase 2.2a: タスク日付管理システム」は完了扱いですが、中核コンポーネント `DateNavigation.tsx` の日付選択ボタンは、実際には `console.log` を出力するだけで、日付ピッカーを呼び出す機能が実装されていません。
    -   **リスク**: ユーザーは日付を自由に選択できず、アプリケーションの基本機能が欠落しています。これは「Today-First UX」の思想とも矛盾します。

-   **不十分な統計機能**:
    -   **状況**: `phase-todo.md`では「フォーカスモードの改善」の一部として統計機能が挙げられていますが、`TaskStatistics.tsx` コンポーネントはタスクの件数や見積時間しか表示しません。「フォーカスセッション時間」など、本来あるべき統計情報が欠落しています。
    -   **リスク**: 要件と実装が乖離しており、ユーザーに価値を提供できていません。

### 4.2. ドキュメント間の矛盾と品質懸念

-   **課題管理の不整合**:
    -   **状況**: `tests/layout-basic.spec.ts` には「長いタスク名によるUI破壊」を検出するテストが存在しますが、現在の `issues-tracking.md` にはこの問題が記載されていません。過去に存在したバグか、現在も潜在しているバグか不明確であり、課題管理が正確に行われていない可能性を示唆しています。
    -   **リスク**: 潜在的なバグが見過ごされ、将来的に再発する可能性があります。

-   **テストの網羅性への懸念**:
    -   **状況**: E2Eテストがレイアウトのスクリーンショット比較に偏っており、ユーザーの主要な操作フロー（例: タスクを追加し、日付を変更し、完了させ、統計に反映されるかを確認する）を検証するテストが不足しているように見受けられます。
    -   **リスク**: リファクタリング時などに、意図しない機能の破壊（デグレード）を見逃す危険性が高いです。

## 5. 提言

1.  **アーキテクチャ統一の断行**: `docs/adr/0001-capacitor-unified-architecture.md` に基づき、**Capacitorへのアーキテクチャ統一**を最優先で進めるべきです。これにより、コードの重複がなくなり、他のすべての負債（状態管理、テスト）の解決が容易になります。
2.  **品質ゲートの設置**: CI（継続的インテグレーション）を導入し、**テストとリンターの実行をマージの必須条件**とすることで、テストカバレッジの向上とコード品質の維持を強制すべきです。
3.  **タスクの再評価**: 本レポートの結果を基に、`@planner` は `phase-todo.md` と `issues-tracking.md` の優先度を再評価し、技術的負債の返済を計画に組み込む必要があります。

以上
