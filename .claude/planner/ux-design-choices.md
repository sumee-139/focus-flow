# Phase 2.1b UX設計選択肢

## 🚨 背景：レビューで判明した仕様の曖昧性

Builderへの実装指示書をレビューした結果、以下の**Critical Issues**が判明いたしました：

### 問題1: 既存システムとの統合方法が不明確
- **現状**: DailyMemoコンポーネントが既に完成している
- **課題**: 新しいサイドパネル内でDailyMemoをどう表示するか未定義
- **影響**: 実装開始できない状態

### 問題2: モバイル対応の具体的UI設計が曖昧
- **現状**: 「1200px以下でアコーディオンUI」と記載
- **課題**: 具体的なレイアウト・ナビゲーション方法が未定義
- **影響**: レスポンシブ実装の方向性が定まらない

### 問題3: データ管理方式の整合性問題
- **現状**: 既存の`useLocalStorage`パターンがある
- **課題**: 新機能のデータをどのキー設計で管理するか未定義
- **影響**: パフォーマンス・保守性に大きく影響

## 🤔 プロダクトオーナー判断が必要な設計選択肢

これらの問題を解決するため、技術的に実装可能な複数案を整理いたしました。
**各選択肢は相互に影響するため、一貫した方針決定が必要**です。

---

## 選択肢1: 既存DailyMemoコンポーネントの活用方法

### 📋 この選択肢の背景
**現在の状況**: 
- DailyMemoコンポーネントが完成済み（3秒自動保存、日付別管理等）
- メインエリア（70%）で全画面表示として設計されている
- 新機能では「サイドパネル内での表示」が必要

**判断が必要な理由**:
- 既存コンポーネントを改修するか、新規作成するかで開発工数が大きく変わる
- データの一貫性とコードの保守性にも影響
- 将来的なUI分岐への対応方針も関連

### 🅰️ 案A: 既存DailyMemo改修方式
```typescript
interface DailyMemoProps {
  embedded?: boolean  // パネル内表示時はtrue
  onQuoteRequest?: (content: string) => void
}
```

**メリット**:
- 既存のロジック・状態管理をそのまま活用
- 開発工数が少ない（推定1-2日短縮）
- データの一貫性が保たれる
- バグのリスクが低い

**デメリット**:
- DailyMemoコンポーネントが複雑になる
- パネル表示とメイン表示で微妙な差異が生じる可能性
- テストケースが複雑化

### 🅱️ 案B: DailyMemoView新規作成方式
```typescript
// 完全に新しいコンポーネント
const DailyMemoView: React.FC<{ embedded: true }> = () => {
  // DailyMemoと同じデータを共有するが、UI専用コンポーネント
}
```

**メリット**:
- パネル専用に最適化されたUI
- 既存DailyMemoへの影響なし
- テストが単純
- 将来的なUI分岐に対応しやすい

**デメリット**:
- 同じロジックの重複実装
- データ同期の複雑性
- 開発工数増加（推定2-3日）

---

## 選択肢2: モバイル対応のUI設計（1200px以下）

### 📋 この選択肢の背景
**現在の状況**:
- デスクトップ版では「タスクリスト30% + メモパネル70%」の設計
- モバイル（1200px以下）では物理的にこの比率が使用困難
- プロダクトオーナーフィードバックで「モバイル対応」が高優先度に設定

**判断が必要な理由**:
- モバイルでの基本UXパターンが決まらないと実装設計できない
- タスク切り替えの頻度とメモ集中のバランスに関わる
- Focus-Flowの「集中」コンセプトとマルチタスクのトレードオフ

**技術的制約**:
- 1200px以下でタスクリストとメモを同時表示すると、どちらも狭すぎて使いにくい
- モバイルタッチ操作での切り替えUI設計が必要

### 🅰️ 案A: 全画面モーダル方式
```css
@media (max-width: 1200px) {
  .memo-panel {
    width: 100vw;
    height: 100vh;
    top: 0;
    left: 0;
    z-index: 2000;
  }
  
  .task-list {
    display: none; /* 完全に隠す */
  }
}
```

**メリット**:
- 小画面で集中しやすい
- 実装がシンプル
- パフォーマンスが良い
- モバイルアプリライクなUX

**デメリット**:
- タスク一覧が見えない
- 他タスクのメモに切り替えにくい
- 戻るボタン等のナビゲーションが必要

### 🅱️ 案B: 上下分割方式
```css
@media (max-width: 1200px) {
  .main-layout {
    flex-direction: column;
  }
  
  .tasks-sidebar {
    width: 100%;
    height: 40vh;
  }
  
  .memo-panel {
    width: 100%;
    height: 60vh;
  }
}
```

**メリット**:
- タスク一覧が常に見える
- タスク切り替えが容易
- デスクトップとの一貫性
- マルチタスクに対応

**デメリット**:
- 画面が狭くなる（メモエリア60%のみ）
- スクロールが必要になる場合がある
- 複雑なレイアウト制御

---

## 選択肢3: LocalStorageの設計方針

### 📋 この選択肢の背景
**現在の状況**:
- 既存システムで`useLocalStorage`パターンが確立済み
- Tasks: `'focus-flow-tasks'`、DailyMemo: コンポーネント内で`'daily-memo-YYYY-MM-DD'`
- 新機能でTaskMemoデータの保存方式を決定する必要

**判断が必要な理由**:
- データ量増加によるパフォーマンス影響（特にタスクが多い場合）
- 将来的なデータバックアップ・エクスポート機能への影響
- ブラウザのLocalStorage容量制限（5-10MB）に対する戦略

**技術的考慮点**:
- 現在70テスト全通過の状態を崩さない設計が必要
- 既存の`useLocalStorage`hookとの互換性
- エラーハンドリングの一貫性

### 🅰️ 案A: 統合型（1つのキー）
```typescript
interface AppData {
  tasks: Task[]
  dailyMemos: Record<string, DailyMemoData>
  taskMemos: Record<string, TaskMemoData>
}
// キー: 'focus-flow-app-data'
```

**メリット**:
- データの整合性が高い
- バックアップ・復元が容易
- トランザクション的な操作
- デバッグが簡単

**デメリット**:
- 大容量時のパフォーマンス問題（全データ読み書き）
- 部分更新の非効率性
- LocalStorage容量制限（5-10MB）への到達リスク

### 🅱️ 案B: 分離型（複数キー）
```typescript
// 'focus-flow-tasks' （既存）
// 'focus-flow-daily-memos' 
// 'focus-flow-task-memos'
```

**メリット**:
- 高いパフォーマンス（必要な部分のみアクセス）
- 部分的な読み書きが効率的
- 容量分散によるリスク軽減
- 既存システムとの一貫性

**デメリット**:
- データ同期の複雑性
- 整合性チェックが困難
- デバッグが煩雑（複数のキーを確認）

---

## 💡 Plannerの推奨案（技術的観点）

**MVP開発効率を重視**した推奨：

1. **DailyMemo活用**: 🅰️案A（改修方式）
   - 理由: データ一貫性とMVP開発スピード重視

2. **モバイル対応**: 🅰️案A（全画面モーダル）
   - 理由: シンプルさとユーザビリティの両立、Focus-Flowの「集中」コンセプトに合致

3. **LocalStorage**: 🅱️案B（分離型）
   - 理由: 既存パターンとの一貫性、将来のスケーラビリティ

---

## 📝 判断をお聞きしたいポイント

### 1. 開発vs品質のバランス
- **開発スピード重視** → 案A系を選択
- **長期品質重視** → 案B系を選択

### 2. モバイルUXの重要度
- **集中重視** → 全画面モーダル
- **マルチタスク重視** → 上下分割

### 3. データ管理の方針
- **シンプルさ重視** → 統合型
- **パフォーマンス重視** → 分離型

## 🎯 各選択肢の相互影響

### 組み合わせパターンの例

**パターン1: 開発効率重視**
- DailyMemo: 案A（改修）
- モバイル: 案A（全画面）  
- Storage: 案B（分離）
→ 開発期間: 3-4日、シンプルなUX

**パターン2: 長期品質重視**
- DailyMemo: 案B（新規）
- モバイル: 案B（分割）
- Storage: 案A（統合）
→ 開発期間: 5-6日、高機能なUX

**パターン3: バランス重視**
- DailyMemo: 案A（改修）
- モバイル: 案A（全画面）
- Storage: 案A（統合）
→ 開発期間: 4日、中程度のUX

## ✍️ コメント記入欄

**選択肢1（DailyMemo活用）**: 
- お選びの案: A
- 理由: 既にコンポーネントとして切っており、機能的な差異がほぼない以上、そのまま使うのが妥当でしょう

**選択肢2（モバイル対応）**: 
- お選びの案: A
- 理由: メモを表示する状態とタスクを表示する状態を完全に分離したかっただけなので、これでよいです。ただタスクメモを表示する場合は、当該タスクカードとタスクメモだけを表示した状態にしたいです。

**選択肢3（LocalStorage）**: 
- お選びの案: B
- 理由: LocalStorageで限界に来たらSQLiteを導入するまでですが、一旦パフォーマンスを優先します。ちなみにタスクメモはタスク単位で生成されますが、そのあたりも考慮してますか？

**開発期間の優先度**: 
- [x] 速度重視（3-4日）
- [ ] 品質重視（5-6日）
- [ ] バランス重視（4日）

**その他のご意見・要望**: 
この設計とは関係ないのですが、テストユーザーから「ポモドーロタイマー機能が欲しい」という声を貰いました。将来的にフォーカスモードに統合しようかと考えてます。優先順位は低いので、機能一覧に加えておいてください。

---

*ご記入いただいた内容を基に、明確で実装可能な仕様書v4.0を作成いたします*